rule ransomware_behavior {
    meta:
        description = "Detects ransomware-like behavior patterns"
        severity = "critical"
        version = "1.0.0"
        author = "SmartShieldAI"
        attack_type = "Ransomware"
    strings:
        $encrypt_ext = /\.(encrypted|locked|crypted|cry|crypt|crypto|enc|pay|wallet|btc|ransom)$/i
        $ransom_note = /(HOW_TO_DECRYPT|DECRYPT_INSTRUCTION|YOUR_FILES|RECOVER_FILES)\.(txt|html|htm)/i
        $crypto_api = /(CryptoAPI|CryptEncrypt|CryptGenKey|EVP_EncryptInit)/i
        $mass_rename = /(rename|ren)\s+.*\s+\*\./i
        $delete_shadows = /vssadmin.*(delete|remove)\s+shadows/i
    condition:
        2 of them
}

rule trojan_behavior {
    meta:
        description = "Detects trojan-like behavior and common trojan patterns"
        severity = "high"
        version = "1.0.0"
        author = "SmartShieldAI"
        attack_type = "Trojan"
    strings:
        $registry_auto = /(CurrentVersion|WindowsNT)\\Run/i
        $hidden_proc = /(taskkill|killproc).*(svchost|explorer|taskmgr)/i
        $disable_security = /(sc|net|taskkill).*(stop|delete|kill).*(defender|firewall|avast|norton)/i
        $keylogger = /(GetAsyncKeyState|keybd_event|KEYEVENTF)/i
        $screen_capture = /(BitBlt|GetDC|CreateCompatibleDC)/i
    condition:
        2 of them
}

rule rootkit_detection {
    meta:
        description = "Detects rootkit-like behavior and common rootkit patterns"
        severity = "critical"
        version = "1.0.0"
        author = "SmartShieldAI"
        attack_type = "Rootkit"
    strings:
        $hide_files = /(SetFileAttributes.*HIDDEN|attrib.*\+h)/i
        $driver_load = /(ZwLoadDriver|NtLoadDriver|ServiceStart)/i
        $hook_api = /(WriteProcessMemory|VirtualProtect|ZwWriteVirtualMemory)/i
        $sys_callback = /(PsSetCreateProcessNotifyRoutine|PsSetLoadImageNotifyRoutine)/i
        $kernel_mod = /(ZwSystemDebugControl|KeServiceDescriptorTable)/i
    condition:
        2 of them
}

rule botnet_behavior {
    meta:
        description = "Detects botnet-like behavior and command patterns"
        severity = "high"
        version = "1.0.0"
        author = "SmartShieldAI"
        attack_type = "Botnet"
    strings:
        $irc_commands = /(JOIN|NICK|PRIVMSG|USER).{0,30}(bot|zombie|slave)/i
        $ddos_strings = /(ICMP|SYN|UDP).*(flood|attack|down)/i
        $c2_patterns = /(check[_-]?in|heart[_-]?beat|beacon)/i
        $persistence = /(HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run)/i
        $spam_engine = /(smtp|send[_-]?mail).*(relay|bulk)/i
    condition:
        2 of them
}

rule malicious_macro {
    meta:
        description = "Detects malicious macro code and behaviors"
        severity = "high"
        version = "1.0.0"
        author = "SmartShieldAI"
        attack_type = "Macro"
    strings:
        $auto_exec = /(Auto_Open|AutoExec|Document_Open|Workbook_Open)/i
        $shell_exec = /(Shell|WScript\.Shell|ShellExecute|ExecuteExcel4Macro)/i
        $download = /(URLDownloadToFile|XMLHTTP|MSXml2\.XMLHTTP|WinHttp\.WinHttpRequest)/i
        $powershell = /(powershell|pwsh).*(hidden|encoded|bypass)/i
        $suspicious = /(Chr\(|RegWrite|CreateObject|GetObject)/i
    condition:
        2 of them
}